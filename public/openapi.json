{
  "openapi": "3.0.3",
  "info": {
    "title": "BRIXTA - Daily Visit Reports API (Read-Only)",
    "description": "A focused API specification for querying Daily Visit Reports (DVRs). This contract precisely defines the behavior of the GET endpoints for /api/daily-visit-reports.",
    "version": "1.0.0"
  },
  "servers": [
    {
      "url": "/api"
    }
  ],
  "tags": [
    {
      "name": "Daily Visit Reports",
      "description": "Read-only operations for retrieving DVRs."
    }
  ],
  "paths": {
    "/daily-visit-reports": {
      "get": {
        "tags": ["Daily Visit Reports"],
        "summary": "Get All Reports with Filtering",
        "description": "Fetches a list of all DVRs with optional filtering by user, date range, dealer type, and visit type. Results are returned in descending order of report date.",
        "parameters": [
          { "$ref": "#/components/parameters/Limit" },
          { "$ref": "#/components/parameters/StartDate" },
          { "$ref": "#/components/parameters/EndDate" },
          { "$ref": "#/components/parameters/UserIdQuery" },
          { "$ref": "#/components/parameters/DealerTypeQuery" },
          { "$ref": "#/components/parameters/VisitTypeQuery" }
        ],
        "responses": {
          "200": { "$ref": "#/components/responses/DVRListSuccess" },
          "500": { "$ref": "#/components/responses/ServerError" }
        }
      }
    },
    "/daily-visit-reports/{id}": {
      "get": {
        "tags": ["Daily Visit Reports"],
        "summary": "Get Report by ID",
        "description": "Retrieves a single daily visit report by its unique ID.",
        "parameters": [ { "$ref": "#/components/parameters/ReportIdPath" } ],
        "responses": {
          "200": {
            "description": "The requested report object.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean", "example": true },
                    "data": { "$ref": "#/components/schemas/DVR_Response" }
                  }
                }
              }
            }
          },
          "404": { "$ref": "#/components/responses/NotFound" },
          "500": { "$ref": "#/components/responses/ServerError" }
        }
      }
    },
    "/daily-visit-reports/user/{userId}": {
      "get": {
        "tags": ["Daily Visit Reports"],
        "summary": "Get Reports by User ID",
        "description": "Fetches a list of reports for a specific user, with optional filtering.",
        "parameters": [
          { "$ref": "#/components/parameters/UserIdPath" },
          { "$ref": "#/components/parameters/Limit" },
          { "$ref": "#/components/parameters/StartDate" },
          { "$ref": "#/components/parameters/EndDate" },
          { "$ref": "#/components/parameters/DealerTypeQuery" },
          { "$ref": "#/components/parameters/VisitTypeQuery" }
        ],
        "responses": {
          "200": { "$ref": "#/components/responses/DVRListSuccess" },
          "500": { "$ref": "#/components/responses/ServerError" }
        }
      }
    },
    "/daily-visit-reports/visit-type/{visitType}": {
      "get": {
        "tags": ["Daily Visit Reports"],
        "summary": "Get Reports by Visit Type",
        "description": "Fetches a list of reports matching a specific visit type, with optional filtering.",
        "parameters": [
          { "$ref": "#/components/parameters/VisitTypePath" },
          { "$ref": "#/components/parameters/Limit" },
          { "$ref": "#/components/parameters/StartDate" },
          { "$ref": "#/components/parameters/EndDate" },
          { "$ref": "#/components/parameters/UserIdQuery" },
          { "$ref": "#/components/parameters/DealerTypeQuery" }
        ],
        "responses": {
          "200": { "$ref": "#/components/responses/DVRListSuccess" },
          "500": { "$ref": "#/components/responses/ServerError" }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "DVR_Base": {
        "type": "object",
        "properties": {
          "reportDate": { "type": "string", "format": "date" },
          "dealerType": { "type": "string", "maxLength": 50 },
          "dealerName": { "type": "string", "maxLength": 255, "nullable": true },
          "subDealerName": { "type": "string", "maxLength": 255, "nullable": true },
          "location": { "type": "string", "maxLength": 500 },
          "latitude": { "type": "number", "format": "float" },
          "longitude": { "type": "number", "format": "float" },
          "visitType": { "type": "string", "maxLength": 50 },
          "dealerTotalPotential": { "type": "number", "format": "double" },
          "dealerBestPotential": { "type": "number", "format": "double" },
          "brandSelling": { "type": "array", "items": { "type": "string" }, "minItems": 1 },
          "contactPerson": { "type": "string", "maxLength": 255, "nullable": true },
          "contactPersonPhoneNo": { "type": "string", "maxLength": 20, "nullable": true },
          "todayOrderMt": { "type": "number", "format": "double" },
          "todayCollectionRupees": { "type": "number", "format": "double" },
          "overdueAmount": { "type": "number", "format": "double", "nullable": true },
          "feedbacks": { "type": "string", "maxLength": 500 },
          "solutionBySalesperson": { "type": "string", "maxLength": 500, "nullable": true },
          "anyRemarks": { "type": "string", "maxLength": 500, "nullable": true },
          "checkInTime": { "type": "string", "format": "date-time" },
          "checkOutTime": { "type": "string", "format": "date-time", "nullable": true },
          "inTimeImageUrl": { "type": "string", "format": "uri", "maxLength": 500, "nullable": true },
          "outTimeImageUrl": { "type": "string", "format": "uri", "maxLength": 500, "nullable": true }
        }
      },
      "DVR_Response": {
        "description": "Schema for a Daily Visit Report returned by the API.",
        "allOf": [
          { "$ref": "#/components/schemas/DVR_Base" },
          {
            "type": "object",
            "properties": {
              "id": { "type": "string", "readOnly": true },
              "userId": { "type": "integer", "readOnly": true },
              "createdAt": { "type": "string", "format": "date-time", "readOnly": true },
              "updatedAt": { "type": "string", "format": "date-time", "readOnly": true }
            }
          }
        ]
      },
      "ErrorResponse": {
        "type": "object",
        "properties": {
          "success": { "type": "boolean", "example": false },
          "error": { "type": "string" },
          "details": { "type": "object" }
        }
      }
    },
    "parameters": {
      "Limit": { "name": "limit", "in": "query", "schema": { "type": "integer", "default": 50 }, "description": "Maximum number of records to return." },
      "StartDate": { "name": "startDate", "in": "query", "schema": { "type": "string", "format": "date" }, "description": "Start date for a date range filter (YYYY-MM-DD)." },
      "EndDate": { "name": "endDate", "in": "query", "schema": { "type": "string", "format": "date" }, "description": "End date for a date range filter (YYYY-MM-DD)." },
      "UserIdQuery": { "name": "userId", "in": "query", "schema": { "type": "integer" }, "description": "Filter by user ID." },
      "DealerTypeQuery": { "name": "dealerType", "in": "query", "schema": { "type": "string" }, "description": "Filter by dealer type." },
      "VisitTypeQuery": { "name": "visitType", "in": "query", "schema": { "type": "string" }, "description": "Filter by visit type." },
      "ReportIdPath": { "name": "id", "in": "path", "required": true, "schema": { "type": "string" }, "description": "The unique ID of the report." },
      "UserIdPath": { "name": "userId", "in": "path", "required": true, "schema": { "type": "integer" }, "description": "The numeric ID of the user." },
      "VisitTypePath": { "name": "visitType", "in": "path", "required": true, "schema": { "type": "string" }, "description": "The visit type to filter or delete by." }
    },
    "responses": {
      "DVRListSuccess": {
        "description": "A list of daily visit reports.",
        "content": {
          "application/json": {
            "schema": {
              "type": "object",
              "properties": {
                "success": { "type": "boolean", "example": true },
                "data": { "type": "array", "items": { "$ref": "#/components/schemas/DVR_Response" } }
              }
            }
          }
        }
      },
      "NotFound": {
        "description": "The requested resource was not found.",
        "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } }
      },
      "ServerError": {
        "description": "An unexpected error occurred on the server.",
        "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } }
      }
    }
  }
}

